<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¹ç›®å›¾çº¸ä¸Šä¼ </title>
    <style>
        body { font-family: system-ui, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .header { text-align: center; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .file-upload { border: 2px dashed #ccc; padding: 30px; text-align: center; border-radius: 5px; }
        .upload-btn { background: #007bff; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; }
        .upload-btn:disabled { background: #ccc; }
        .result { margin-top: 20px; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ é¡¹ç›®å›¾çº¸ä¸Šä¼ </h1>
            <p>ä¸Šä¼ PDFæ ¼å¼çš„å·¥ç¨‹å›¾çº¸ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æå–æ–‡æœ¬å¹¶å»ºç«‹å‘é‡çŸ¥è¯†åº“</p>
        </div>

        <form id="uploadForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label for="projectName">é¡¹ç›®åç§°</label>
                    <input type="text" id="projectName" placeholder="ä¾‹å¦‚ï¼šXXå¤§å¦å·¥ç¨‹">
                </div>
                <div class="form-group">
                    <label for="drawingType">å›¾çº¸ç±»å‹</label>
                    <select id="drawingType">
                        <option value="">è¯·é€‰æ‹©å›¾çº¸ç±»å‹</option>
                        <option value="å»ºç­‘">å»ºç­‘å›¾</option>
                        <option value="ç»“æ„">ç»“æ„å›¾</option>
                        <option value="ç»™æ’æ°´">ç»™æ’æ°´å›¾</option>
                        <option value="ç”µæ°”">ç”µæ°”å›¾</option>
                        <option value="æš–é€š">æš–é€šå›¾</option>
                        <option value="è£…ä¿®">è£…ä¿®å›¾</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label for="drawingPhase">è®¾è®¡é˜¶æ®µ</label>
                    <select id="drawingPhase">
                        <option value="">è¯·é€‰æ‹©è®¾è®¡é˜¶æ®µ</option>
                        <option value="æ–¹æ¡ˆè®¾è®¡">æ–¹æ¡ˆè®¾è®¡</option>
                        <option value="åˆæ­¥è®¾è®¡">åˆæ­¥è®¾è®¡</option>
                        <option value="æ–½å·¥å›¾è®¾è®¡">æ–½å·¥å›¾è®¾è®¡</option>
                        <option value="ç«£å·¥å›¾">ç«£å·¥å›¾</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="createdBy">ä¸Šä¼ è€…</label>
                    <input type="text" id="createdBy" placeholder="æ‚¨çš„å§“å">
                </div>
            </div>

            <div class="form-group">
                <label>é€‰æ‹©PDFå›¾çº¸æ–‡ä»¶</label>
                <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                    <div id="uploadText">ğŸ“„ ç‚¹å‡»é€‰æ‹©PDFæ–‡ä»¶ (æœ€å¤§100MB)</div>
                    <input type="file" id="fileInput" accept=".pdf" style="display: none;">
                </div>
            </div>

            <button type="submit" class="upload-btn" id="uploadBtn" disabled>ğŸš€ å¼€å§‹ä¸Šä¼ å’Œå¤„ç†</button>
        </form>

        <div id="progress" class="result hidden">
            <h3>â³ å¤„ç†ä¸­...</h3>
            <p id="progressText">å‡†å¤‡ä¸Šä¼ ...</p>
        </div>

        <div id="result" class="hidden"></div>

        <div style="margin-top: 30px; text-align: center;">
            <a href="/">ğŸ  è¿”å›é¦–é¡µ</a> | 
            <a href="/admin">âš™ï¸ ç®¡ç†é¡µé¢</a>
        </div>
    </div>

    <script>
        let selectedFile = null;

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.type !== 'application/pdf') {
                    alert('è¯·é€‰æ‹©PDFæ ¼å¼çš„æ–‡ä»¶');
                    return;
                }
                if (file.size > 100 * 1024 * 1024) {
                    alert('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡100MB');
                    return;
                }
                selectedFile = file;
                document.getElementById('uploadText').innerHTML = 
                    `âœ… å·²é€‰æ‹©: ${file.name} (${(file.size/1024/1024).toFixed(2)}MB)`;
                document.getElementById('uploadBtn').disabled = false;
            }
        });

        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!selectedFile) {
                alert('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶');
                return;
            }

            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('project_name', document.getElementById('projectName').value);
            formData.append('drawing_type', document.getElementById('drawingType').value);
            formData.append('drawing_phase', document.getElementById('drawingPhase').value);
            formData.append('created_by', document.getElementById('createdBy').value);

            // æ˜¾ç¤ºè¿›åº¦
            document.getElementById('progress').classList.remove('hidden');
            document.getElementById('result').classList.add('hidden');
            document.getElementById('uploadBtn').disabled = true;

            try {
                const response = await fetch('/upload-drawing', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                document.getElementById('progress').classList.add('hidden');

                if (response.ok) {
                    document.getElementById('result').innerHTML = `
                        <div class="success">
                            <h3>âœ… å›¾çº¸å¤„ç†æˆåŠŸï¼</h3>
                            <p><strong>å›¾çº¸ID:</strong> ${result.drawing_id}</p>
                            <p><strong>å›¾çº¸åç§°:</strong> ${result.drawing_name}</p>
                            <p><strong>æ–‡ä»¶å¤§å°:</strong> ${result.file_size_mb} MB</p>
                            <p><strong>å‘é‡å—æ•°:</strong> ${result.vector_chunks_count}</p>
                            <p><strong>å¤„ç†çŠ¶æ€:</strong> ${result.process_status}</p>
                            <p><strong>å­˜å‚¨é“¾æ¥:</strong> <a href="${result.minio_url}" target="_blank">æŸ¥çœ‹æ–‡ä»¶</a></p>
                        </div>
                    `;
                    // é‡ç½®è¡¨å•
                    document.getElementById('uploadForm').reset();
                    selectedFile = null;
                    document.getElementById('uploadText').innerHTML = 'ğŸ“„ ç‚¹å‡»é€‰æ‹©PDFæ–‡ä»¶ (æœ€å¤§100MB)';
                } else {
                    document.getElementById('result').innerHTML = `
                        <div class="error">
                            <h3>âŒ å¤„ç†å¤±è´¥</h3>
                            <p>${result.detail || 'ä¸Šä¼ å¤±è´¥'}</p>
                        </div>
                    `;
                    document.getElementById('uploadBtn').disabled = false;
                }
            } catch (error) {
                document.getElementById('progress').classList.add('hidden');
                document.getElementById('result').innerHTML = `
                    <div class="error">
                        <h3>âŒ ç½‘ç»œé”™è¯¯</h3>
                        <p>${error.message}</p>
                    </div>
                `;
                document.getElementById('uploadBtn').disabled = false;
            }

            document.getElementById('result').classList.remove('hidden');
        });
    </script>
</body>
</html> 